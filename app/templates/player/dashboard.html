{% extends "layout.html" %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-4">ğŸ® æ¬¢è¿å›æ¥ï¼Œ<strong>{{ current_user.username }}</strong></h2>

  <!-- å½“å‰é¢˜ç›®çŸ©é˜µ -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      ğŸ¯ å½“å‰é¢˜ç›®çŸ©é˜µ
    </div>
    <div class="card-body">

      <div class="matrix-grid" style="--matrix-size: {{ config.matrix_size }}">
        {% for i in range(config.matrix_size) %}
          {% for j in range(config.matrix_size) %}
            {% set p = problem_dict.get((i, j)) %}
            {% if p %}
              {% set color = "#eeeeee" %}
              {% set status_icon = "â¬œ" %}
              {% if p.id in completed_ids %}
                {% set color = "#d4edda" %}
                {% set status_icon = "âœ…" %}
              {% elif sub_map.get(p.id) == 'pending' %}
                {% set color = "#fff3cd" %}
                {% set status_icon = "âŒ›" %}
              {% elif sub_map.get(p.id) == 'rejected' %}
                {% set color = "#f8d7da" %}
                {% set status_icon = "âŒ" %}
              {% endif %}
              <a href="{{ url_for('player_bp.view_problem', pid=p.id) }}"
                 class="square-cell text-dark text-decoration-none fw-bold"
                 style="background-color: {{ color }};"
                 title="ç‚¹å‡»è¿›å…¥é¢˜ç›® ({{ i }}, {{ j }})">
                {{ status_icon }}
              </a>
            {% else %}
              <div class="square-cell bg-secondary text-white" title="å°šæœªå‘å¸ƒ">Ã—</div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </div>

    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">å¾’æ­¥åœ°å›¾ä¸ç´§æ€¥è”ç³»äºº</div>
    <center><img src="{{ url_for('static', filename='map.png') }}" width="80%"></center> 
    <div class="card-body">
    <p><strong>ç´§æ€¥è”ç³»äººï¼š</strong>Fang Sihan 84245903</p>
  </div>
  </div>

  <!-- å›¢é˜Ÿæˆå‘˜ -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">ğŸ‘¥ å›¢é˜Ÿæˆå‘˜</div>
    <div class="card-body">
      {% if teammates %}
        {% for mate in teammates %}
          <span class="badge bg-primary me-1">{{ mate.username }}</span>
        {% endfor %}
      {% else %}
        <p class="text-muted">æš‚æ— å…¶ä»–æˆå‘˜</p>
      {% endif %}
    </div>
  </div>

 <!-- å›¢é˜Ÿç»Ÿè®¡ -->
<div class="row mb-4">
    <!-- ğŸ“„ æäº¤æ€»æ•° -->
    <div class="col-md-3 mb-3">
      <div class="card text-white bg-primary h-100">
        <div class="card-body text-center">
          <h5 class="card-title">ğŸ“„ æäº¤æ€»æ•°</h5>
          <p class="display-6">{{ team_stats.total }}</p>
        </div>
      </div>
    </div>
  
    <!-- âœ… å·²å®Œæˆ -->
    <div class="col-md-3 mb-3">
      <div class="card text-white bg-success h-100">
        <div class="card-body text-center">
          <h5 class="card-title">âœ… å·²å®Œæˆé¢˜ç›®</h5>
          <p class="display-6">{{ team_stats.passed }}</p>
        </div>
      </div>
    </div>
  
    <!-- âŒ è¢«æ‹’ -->
    <div class="col-md-3 mb-3">
      <div class="card text-white bg-danger h-100">
        <div class="card-body text-center">
          <h5 class="card-title">âŒ è¢«æ‹’é¢˜ç›®</h5>
          <p class="display-6">{{ team_stats.rejected }}</p>
        </div>
      </div>
    </div>
  
    <!-- ğŸ‰ BINGO æ•° -->
    <div class="col-md-3 mb-3">
      <div class="card text-white bg-warning h-100">
        <div class="card-body text-center">
          <h5 class="card-title">ğŸ‰ BINGO æ•°</h5>
          <p class="display-6">{{ team_stats.bingo }}</p>
        </div>
      </div>
    </div>
  </div>
  

  <!-- æ‰€æœ‰å›¢é˜Ÿ BINGO æ’è¡Œ -->
  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">ğŸ† æ‰€æœ‰å›¢é˜Ÿ BINGO æ’è¡Œ</div>
    <ol class="list-group list-group-numbered">
      {% for team_name, bingo in all_bingo_counts %}
        <li class="list-group-item d-flex justify-content-between align-items-center 
            {% if loop.index == 1 %}bg-warning-subtle{% elif loop.index == 2 %}bg-light{% endif %}">
          <strong>{{ team_name }}</strong>
          <span class="badge bg-success rounded-pill">{{ bingo }} ä¸ª</span>
        </li>
      {% endfor %}
    </ol>
  </div>
</div>
{% endblock %}
